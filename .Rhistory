+ lag(pdataSet$RelPerf1m, 1)
+ lag(pdataSet$RelPerf1m, 2)
+ lag(pdataSet$RelPerf1m, 3)
+ lag(pdataSet$RelPerf1m, 4)
+ lag(pdataSet$RelPerf1m, 5)
+ lag(pdataSet$RelPerf1m, 6)
+ lag(pdataSet$AbsPerf1m, 1)
+ lag(pdataSet$AbsPerf1m, 2)
+ lag(pdataSet$AbsPerf1m, 3)
+ lag(pdataSet$AbsPerf1m, 4)
+ lag(pdataSet$AbsPerf1m, 5)
+ lag(pdataSet$AbsPerf1m, 6)
+ lag(pdataSet$Rank1m, 1)
+ lag(pdataSet$Rank1m, 2)
+ lag(pdataSet$Rank1m, 3)
+ lag(pdataSet$Rank1m, 4)
+ lag(pdataSet$Rank1m, 5)
+ lag(pdataSet$Rank1m, 6)
+ lag(pdataSet$RelPerf3m, 1)
+ lag(pdataSet$RelPerf3m, 2)
+ lag(pdataSet$RelPerf3m, 3)
+ lag(pdataSet$RelPerf3m, 4)
+ lag(pdataSet$RelPerf3m, 5)
+ lag(pdataSet$RelPerf3m, 6)
+ lag(pdataSet$AbsPerf3m, 1)
+ lag(pdataSet$AbsPerf3m, 2)
+ lag(pdataSet$AbsPerf3m, 3)
+ lag(pdataSet$AbsPerf3m, 4)
+ lag(pdataSet$AbsPerf3m, 5)
+ lag(pdataSet$AbsPerf3m, 6)
+ lag(pdataSet$Rank3m, 1)
+ lag(pdataSet$Rank3m, 2)
+ lag(pdataSet$Rank3m, 3)
+ lag(pdataSet$Rank3m, 4)
+ lag(pdataSet$Rank3m, 5)
+ lag(pdataSet$Rank3m, 6)
, data=pdataSet, na.action=na.omit)
finalLags <- step(laggedMod, direction="both")
summary(finalLags)
discMod <- lm(NCCF ~
+ RelPerf3m
+ RelPerf3y
+ lag(pdataSet$RelPerf1m, 4)
+ lag(pdataSet$RelPerf1m, 5)
+ lag(pdataSet$RelPerf1m, 6)
+ lag(pdataSet$Rank1m, 2)
+ lag(pdataSet$Rank1m, 3)
+ lag(pdataSet$RelPerf3m, 1)
+ lag(pdataSet$RelPerf3m, 3)
+ lag(pdataSet$RelPerf3m, 4)
+ lag(pdataSet$RelPerf3m, 5)
+ lag(pdataSet$RelPerf3m, 6)
+ lag(pdataSet$AbsPerf3m, 6)
+ lag(pdataSet$Rank3m, 5)
+ lag(pdataSet$Rank3m, 6)
, data=pdataSet, na.action=na.omit)
summary(discMod)
discMod <- lm(NCCF ~
+ RelPerf3m
+ RelPerf3y
+ lag(pdataSet$Rank1m, 2)
+ lag(pdataSet$Rank1m, 3)
+ lag(pdataSet$RelPerf3m, 1)
+ lag(pdataSet$RelPerf3m, 3)
, data=pdataSet, na.action=na.omit)
summary(discMod)
summary(finalLags)
discMod <- lm(NCCF ~
+ Rank1y
+ RelPerf3y
+ lag(pdataSet$Rank1m, 2)
+ lag(pdataSet$Rank1m, 3)
+ lag(pdataSet$RelPerf3m, 1)
+ lag(pdataSet$RelPerf3m, 3)
, data=pdataSet, na.action=na.omit)
summary(discMod)
discMod <- lm(NCCF ~
+ Rank1y
+ RelPerf3y
#+ lag(pdataSet$Rank1m, 2)
#+ lag(pdataSet$Rank1m, 3)
+ lag(pdataSet$RelPerf3m, 1)
#+ lag(pdataSet$RelPerf3m, 3)
, data=pdataSet, na.action=na.omit)
summary(discMod)
discMod <- lm(NCCF ~
+ Rank1y
+ RelPerf3y
#+ lag(pdataSet$Rank1m, 2)
#+ lag(pdataSet$Rank1m, 3)
#+ lag(pdataSet$RelPerf3m, 1)
#+ lag(pdataSet$RelPerf3m, 3)
, data=pdataSet, na.action=na.omit)
summary(discMod)
laggedMod <- lm(NCCF ~
RelPerf3m
+ lag(pdataSet$RelPerf1m, 1)
+ lag(pdataSet$RelPerf1m, 2)
+ lag(pdataSet$RelPerf1m, 3)
+ lag(pdataSet$RelPerf1m, 4)
+ lag(pdataSet$RelPerf1m, 5)
+ lag(pdataSet$RelPerf1m, 6)
+ AbsPerf1m
+ lag(pdataSet$AbsPerf1m, 1)
+ lag(pdataSet$AbsPerf1m, 2)
+ lag(pdataSet$AbsPerf1m, 3)
+ lag(pdataSet$AbsPerf1m, 4)
+ lag(pdataSet$AbsPerf1m, 5)
+ lag(pdataSet$AbsPerf1m, 6)
+ Rank1m
+ lag(pdataSet$Rank1m, 1)
+ lag(pdataSet$Rank1m, 2)
+ lag(pdataSet$Rank1m, 3)
+ lag(pdataSet$Rank1m, 4)
+ lag(pdataSet$Rank1m, 5)
+ lag(pdataSet$Rank1m, 6)
, data=pdataSet, na.action=na.omit)
# laggedMod <- lm(NCCF ~
#                   RelPerf1m
#                 + AbsPerf1m
#                 + RelPerf3m
#                 + AbsPerf3m
#                 + RelPerf3y
#                 + Rank1y
#                 + lag(pdataSet$RelPerf1m, 1)
#                 + lag(pdataSet$RelPerf1m, 2)
#                 + lag(pdataSet$RelPerf1m, 3)
#                 + lag(pdataSet$RelPerf1m, 4)
#                 + lag(pdataSet$RelPerf1m, 5)
#                 + lag(pdataSet$RelPerf1m, 6)
#                 + lag(pdataSet$AbsPerf1m, 1)
#                 + lag(pdataSet$AbsPerf1m, 2)
#                 + lag(pdataSet$AbsPerf1m, 3)
#                 + lag(pdataSet$AbsPerf1m, 4)
#                 + lag(pdataSet$AbsPerf1m, 5)
#                 + lag(pdataSet$AbsPerf1m, 6)
#                 + lag(pdataSet$Rank1m, 1)
#                 + lag(pdataSet$Rank1m, 2)
#                 + lag(pdataSet$Rank1m, 3)
#                 + lag(pdataSet$Rank1m, 4)
#                 + lag(pdataSet$Rank1m, 5)
#                 + lag(pdataSet$Rank1m, 6)
#                 + lag(pdataSet$RelPerf3m, 1)
#                 + lag(pdataSet$RelPerf3m, 2)
#                 + lag(pdataSet$RelPerf3m, 3)
#                 + lag(pdataSet$RelPerf3m, 4)
#                 + lag(pdataSet$RelPerf3m, 5)
#                 + lag(pdataSet$RelPerf3m, 6)
#                 + lag(pdataSet$AbsPerf3m, 1)
#                 + lag(pdataSet$AbsPerf3m, 2)
#                 + lag(pdataSet$AbsPerf3m, 3)
#                 + lag(pdataSet$AbsPerf3m, 4)
#                 + lag(pdataSet$AbsPerf3m, 5)
#                 + lag(pdataSet$AbsPerf3m, 6)
#                 + lag(pdataSet$Rank3m, 1)
#                 + lag(pdataSet$Rank3m, 2)
#                 + lag(pdataSet$Rank3m, 3)
#                 + lag(pdataSet$Rank3m, 4)
#                 + lag(pdataSet$Rank3m, 5)
#                 + lag(pdataSet$Rank3m, 6)
#                 , data=pdataSet, na.action=na.omit)
#summary(laggedMod)
finalLags <- step(laggedMod, direction="both")
summary(finalLags)
rm(laggedMod)
source('~/.active-rstudio-document', echo=TRUE)
laggedMod <- lm(NCCF ~
RelPerf3m
+ lag(pdataSet$RelPerf3m, 1)
+ lag(pdataSet$RelPerf3m, 2)
+ lag(pdataSet$RelPerf3m, 3)
+ lag(pdataSet$RelPerf3m, 4)
+ lag(pdataSet$RelPerf3m, 5)
+ lag(pdataSet$RelPerf3m, 6)
+ AbsPerf3m
+ lag(pdataSet$AbsPerf3m, 1)
+ lag(pdataSet$AbsPerf3m, 2)
+ lag(pdataSet$AbsPerf3m, 3)
+ lag(pdataSet$AbsPerf3m, 4)
+ lag(pdataSet$AbsPerf3m, 5)
+ lag(pdataSet$AbsPerf3m, 6)
+ Rank3m
+ lag(pdataSet$Rank3m, 1)
+ lag(pdataSet$Rank3m, 2)
+ lag(pdataSet$Rank3m, 3)
+ lag(pdataSet$Rank3m, 4)
+ lag(pdataSet$Rank3m, 5)
+ lag(pdataSet$Rank3m, 6)
, data=pdataSet, na.action=na.omit)
# laggedMod <- lm(NCCF ~
#                   RelPerf3m
#                 + lag(pdataSet$RelPerf1m, 1)
#                 + lag(pdataSet$RelPerf1m, 2)
#                 + lag(pdataSet$RelPerf1m, 3)
#                 + lag(pdataSet$RelPerf1m, 4)
#                 + lag(pdataSet$RelPerf1m, 5)
#                 + lag(pdataSet$RelPerf1m, 6)
#                 + AbsPerf1m
#                 + lag(pdataSet$AbsPerf1m, 1)
#                 + lag(pdataSet$AbsPerf1m, 2)
#                 + lag(pdataSet$AbsPerf1m, 3)
#                 + lag(pdataSet$AbsPerf1m, 4)
#                 + lag(pdataSet$AbsPerf1m, 5)
#                 + lag(pdataSet$AbsPerf1m, 6)
#                 + Rank1m
#                 + lag(pdataSet$Rank1m, 1)
#                 + lag(pdataSet$Rank1m, 2)
#                 + lag(pdataSet$Rank1m, 3)
#                 + lag(pdataSet$Rank1m, 4)
#                 + lag(pdataSet$Rank1m, 5)
#                 + lag(pdataSet$Rank1m, 6)
#                 , data=pdataSet, na.action=na.omit)
# laggedMod <- lm(NCCF ~
#                   RelPerf1m
#                 + AbsPerf1m
#                 + RelPerf3m
#                 + AbsPerf3m
#                 + RelPerf3y
#                 + Rank1y
#                 + lag(pdataSet$RelPerf1m, 1)
#                 + lag(pdataSet$RelPerf1m, 2)
#                 + lag(pdataSet$RelPerf1m, 3)
#                 + lag(pdataSet$RelPerf1m, 4)
#                 + lag(pdataSet$RelPerf1m, 5)
#                 + lag(pdataSet$RelPerf1m, 6)
#                 + lag(pdataSet$AbsPerf1m, 1)
#                 + lag(pdataSet$AbsPerf1m, 2)
#                 + lag(pdataSet$AbsPerf1m, 3)
#                 + lag(pdataSet$AbsPerf1m, 4)
#                 + lag(pdataSet$AbsPerf1m, 5)
#                 + lag(pdataSet$AbsPerf1m, 6)
#                 + lag(pdataSet$Rank1m, 1)
#                 + lag(pdataSet$Rank1m, 2)
#                 + lag(pdataSet$Rank1m, 3)
#                 + lag(pdataSet$Rank1m, 4)
#                 + lag(pdataSet$Rank1m, 5)
#                 + lag(pdataSet$Rank1m, 6)
#                 + lag(pdataSet$RelPerf3m, 1)
#                 + lag(pdataSet$RelPerf3m, 2)
#                 + lag(pdataSet$RelPerf3m, 3)
#                 + lag(pdataSet$RelPerf3m, 4)
#                 + lag(pdataSet$RelPerf3m, 5)
#                 + lag(pdataSet$RelPerf3m, 6)
#                 + lag(pdataSet$AbsPerf3m, 1)
#                 + lag(pdataSet$AbsPerf3m, 2)
#                 + lag(pdataSet$AbsPerf3m, 3)
#                 + lag(pdataSet$AbsPerf3m, 4)
#                 + lag(pdataSet$AbsPerf3m, 5)
#                 + lag(pdataSet$AbsPerf3m, 6)
#                 + lag(pdataSet$Rank3m, 1)
#                 + lag(pdataSet$Rank3m, 2)
#                 + lag(pdataSet$Rank3m, 3)
#                 + lag(pdataSet$Rank3m, 4)
#                 + lag(pdataSet$Rank3m, 5)
#                 + lag(pdataSet$Rank3m, 6)
#                 , data=pdataSet, na.action=na.omit)
#summary(laggedMod)
finalLags <- step(laggedMod, direction="both")
summary(finalLags)
rm(laggedMod)
discMod <- lm(NCCF ~
+ Rank1y
+ RelPerf3y
#+ lag(pdataSet$Rank1m, 2)
+ lag(pdataSet$Rank3m, 2)
#+ lag(pdataSet$RelPerf3m, 1)
#+ lag(pdataSet$RelPerf3m, 3)
, data=pdataSet, na.action=na.omit)
summary(discMod)
source('~/.active-rstudio-document', echo=TRUE)
laggedMod <- lm(NCCF ~
RelPerf1m
+ AbsPerf1m
+ RelPerf3m
+ AbsPerf3m
+ RelPerf3y
+ Rank1y
+ lag(pdataSet$RelPerf1m, 1)
+ lag(pdataSet$RelPerf1m, 2)
+ lag(pdataSet$RelPerf1m, 3)
#                 + lag(pdataSet$RelPerf1m, 4)
#                 + lag(pdataSet$RelPerf1m, 5)
#                 + lag(pdataSet$RelPerf1m, 6)
+ lag(pdataSet$AbsPerf1m, 1)
+ lag(pdataSet$AbsPerf1m, 2)
+ lag(pdataSet$AbsPerf1m, 3)
#                 + lag(pdataSet$AbsPerf1m, 4)
#                 + lag(pdataSet$AbsPerf1m, 5)
#                 + lag(pdataSet$AbsPerf1m, 6)
+ lag(pdataSet$Rank1m, 1)
+ lag(pdataSet$Rank1m, 2)
+ lag(pdataSet$Rank1m, 3)
#                 + lag(pdataSet$Rank1m, 4)
#                 + lag(pdataSet$Rank1m, 5)
#                 + lag(pdataSet$Rank1m, 6)
+ lag(pdataSet$RelPerf3m, 1)
+ lag(pdataSet$RelPerf3m, 2)
+ lag(pdataSet$RelPerf3m, 3)
#                 + lag(pdataSet$RelPerf3m, 4)
#                 + lag(pdataSet$RelPerf3m, 5)
#                 + lag(pdataSet$RelPerf3m, 6)
+ lag(pdataSet$AbsPerf3m, 1)
+ lag(pdataSet$AbsPerf3m, 2)
+ lag(pdataSet$AbsPerf3m, 3)
#                 + lag(pdataSet$AbsPerf3m, 4)
#                 + lag(pdataSet$AbsPerf3m, 5)
#                 + lag(pdataSet$AbsPerf3m, 6)
+ lag(pdataSet$Rank3m, 1)
+ lag(pdataSet$Rank3m, 2)
+ lag(pdataSet$Rank3m, 3)
#                 + lag(pdataSet$Rank3m, 4)
#                 + lag(pdataSet$Rank3m, 5)
#                 + lag(pdataSet$Rank3m, 6)
, data=pdataSet, na.action=na.omit)
#summary(laggedMod)
finalLags <- step(laggedMod, direction="both")
summary(finalLags)
rm(laggedMod)
laggedMod <- lm(NCCF ~
RelPerf1m
+ AbsPerf1m
+ RelPerf3m
+ AbsPerf3m
+ RelPerf3y
+ Rank1y
+ lag(pdataSet$RelPerf1m, 1)
+ lag(pdataSet$RelPerf1m, 2)
+ lag(pdataSet$RelPerf1m, 3)
#                 + lag(pdataSet$RelPerf1m, 4)
#                 + lag(pdataSet$RelPerf1m, 5)
#                 + lag(pdataSet$RelPerf1m, 6)
+ lag(pdataSet$AbsPerf1m, 1)
+ lag(pdataSet$AbsPerf1m, 2)
+ lag(pdataSet$AbsPerf1m, 3)
#                 + lag(pdataSet$AbsPerf1m, 4)
#                 + lag(pdataSet$AbsPerf1m, 5)
#                 + lag(pdataSet$AbsPerf1m, 6)
+ lag(pdataSet$Rank1m, 1)
+ lag(pdataSet$Rank1m, 2)
+ lag(pdataSet$Rank1m, 3)
#                 + lag(pdataSet$Rank1m, 4)
#                 + lag(pdataSet$Rank1m, 5)
#                 + lag(pdataSet$Rank1m, 6)
+ lag(pdataSet$RelPerf3m, 1)
+ lag(pdataSet$RelPerf3m, 2)
+ lag(pdataSet$RelPerf3m, 3)
#                 + lag(pdataSet$RelPerf3m, 4)
#                 + lag(pdataSet$RelPerf3m, 5)
#                 + lag(pdataSet$RelPerf3m, 6)
+ lag(pdataSet$AbsPerf3m, 1)
+ lag(pdataSet$AbsPerf3m, 2)
+ lag(pdataSet$AbsPerf3m, 3)
#                 + lag(pdataSet$AbsPerf3m, 4)
#                 + lag(pdataSet$AbsPerf3m, 5)
#                 + lag(pdataSet$AbsPerf3m, 6)
+ lag(pdataSet$Rank3m, 1)
+ lag(pdataSet$Rank3m, 2)
+ lag(pdataSet$Rank3m, 3)
#                 + lag(pdataSet$Rank3m, 4)
#                 + lag(pdataSet$Rank3m, 5)
#                 + lag(pdataSet$Rank3m, 6)
, data=pdataSet, na.action=na.omit)
finalLags <- step(laggedMod, direction="both")
finalLags <- step(laggedMod, direction="backward")
library(plm)
panelSet <- na.omit(panelA[, c("FundCode"
, "RefDate"
, "NCCF"
, "AbsPerf1m"
, "RelPerf1m"
, "AbsPerf3m"
, "RelPerf3m"
, "Rank3m"
, "Rank1m"
, "Rank1y"
, "RelPerf3y")])
pdataSet <- pdata.frame(panelSet
, index = c("FundCode", "RefDate")
, drop.index = FALSE
, row.names = TRUE)
rm(panelSet)
panelSet <- na.omit(panelA[, c("FundCode"
, "RefDate"
, "NCCF"
, "AbsPerf1m"
, "RelPerf1m"
, "AbsPerf3m"
, "RelPerf3m"
, "Rank3m"
, "Rank1m"
, "Rank1y"
, "RelPerf3y")])
pdataSet <- pdata.frame(panelSet
, index = c("FundCode", "RefDate")
, drop.index = FALSE
, row.names = TRUE)
rm(panelSet)
head(pdataSet)
length(unique(pdataSet$FundCode))
laggedMod <- lm(NCCF ~
RelPerf1m
+ AbsPerf1m
+ RelPerf3m
+ AbsPerf3m
+ RelPerf3y
+ Rank1y
+ lag(pdataSet$RelPerf1m, 1)
+ lag(pdataSet$RelPerf1m, 2)
+ lag(pdataSet$RelPerf1m, 3)
#                 + lag(pdataSet$RelPerf1m, 4)
#                 + lag(pdataSet$RelPerf1m, 5)
#                 + lag(pdataSet$RelPerf1m, 6)
+ lag(pdataSet$AbsPerf1m, 1)
+ lag(pdataSet$AbsPerf1m, 2)
+ lag(pdataSet$AbsPerf1m, 3)
#                 + lag(pdataSet$AbsPerf1m, 4)
#                 + lag(pdataSet$AbsPerf1m, 5)
#                 + lag(pdataSet$AbsPerf1m, 6)
+ lag(pdataSet$Rank1m, 1)
+ lag(pdataSet$Rank1m, 2)
+ lag(pdataSet$Rank1m, 3)
#                 + lag(pdataSet$Rank1m, 4)
#                 + lag(pdataSet$Rank1m, 5)
#                 + lag(pdataSet$Rank1m, 6)
+ lag(pdataSet$RelPerf3m, 1)
+ lag(pdataSet$RelPerf3m, 2)
+ lag(pdataSet$RelPerf3m, 3)
#                 + lag(pdataSet$RelPerf3m, 4)
#                 + lag(pdataSet$RelPerf3m, 5)
#                 + lag(pdataSet$RelPerf3m, 6)
+ lag(pdataSet$AbsPerf3m, 1)
+ lag(pdataSet$AbsPerf3m, 2)
+ lag(pdataSet$AbsPerf3m, 3)
#                 + lag(pdataSet$AbsPerf3m, 4)
#                 + lag(pdataSet$AbsPerf3m, 5)
#                 + lag(pdataSet$AbsPerf3m, 6)
+ lag(pdataSet$Rank3m, 1)
+ lag(pdataSet$Rank3m, 2)
+ lag(pdataSet$Rank3m, 3)
#                 + lag(pdataSet$Rank3m, 4)
#                 + lag(pdataSet$Rank3m, 5)
#                 + lag(pdataSet$Rank3m, 6)
, data=pdataSet, na.action=na.omit)
#setwd("g:/GitHub/PerfNCCF/")
library(ggplot2)
library(scales)
library(car)
# library(RODBC)
# channel <- odbcConnect("SQLServerPerfRep")
# rawdata <- sqlQuery(channel, "SELECT * FROM vw_EstimatedNCCF ORDER BY FundCode, RefDate")
# close(channel)
# rm(channel)
# save(rawdata, file = "OMGIset.Rda")
load("OMGIset.Rda")
#str(rawdata)
#summary(rawdata)
#change names
colnames(rawdata)[names(rawdata) == "NCCFEstimate"] <- "NCCF"
rawdata$RefDate <- as.Date(rawdata$RefDate)
print(paste0("Raw number of products: ",
as.character(length(unique(rawdata$FundCode)))))
#remove outliers
NCCFtolerance <- 0.5
print(paste0("Outliers with |NCCF| > ",
as.character(NCCFtolerance*100), "%: " ,
sum(rawdata$NCCF > NCCFtolerance |
rawdata$NCCF < -NCCFtolerance, na.rm = TRUE)))
panelA <- rawdata[rawdata$NCCF < NCCFtolerance &
rawdata$NCCF > -NCCFtolerance, ]
ExcludeFunds <- c("SKPROP")
print(paste0("Excluded funds: ", ExcludeFunds))
sum(panelA$FundCode %in% ExcludeFunds, na.rm=TRUE)
panelA <- panelA[! panelA$FundCode %in% ExcludeFunds, ]
#exclude Select seeded
#summary(panelA$IsSelect)
print(paste0("Seeded Select funds obs.: ", as.character(
sum(panelA$IsSelect == 1, na.rm=TRUE))))
panelA <- panelA[! panelA$IsSelect == 1, ]
print(paste0("Final number of products: ",
as.character(length(unique(panelA$FundCode)))))
print(paste0("Final number of observations: ",
as.character(length(panelA$FundCode))))
#summary(panelA)
#######ADDED SETS
#extreme performers
extremeThresh <- 0.15
panelA_extr <- panelA[panelA$Rank1y < extremeThresh |
panelA$Rank1y > 1- extremeThresh, ]
#normal performers
panelA_mid <- panelA[panelA$Rank1y > extremeThresh &
panelA$Rank1y < 1- extremeThresh, ]
#scaled sets
# dataScaled <- data.frame(scale(panelA[, c("NCCF",
#                                              "RelPerf1y",
#                                              "RelPerf2y",
#                                              "RelPerf3y",
#                                              "RelPerf3m",
#                                              "RelPerf6m",
#                                              "Rank1y",
#                                              "Rank3y")]))
#
print(paste0("Observations: ",
as.character(length(rawdata$FundCode))))
load("COMPset.Rda")
#add variable
compdata$ItemType <- compdata$ItemId
compdata$ItemType <- sub("Comp.", "Competitor", compdata$ItemType)
compdata$ItemType <- sub("BS", "BestSeller", compdata$ItemType)
print(paste0("Raw number of products: ",
as.character(length(unique(compdata$FundId)))))
print(paste0("Observations: ",
as.character(length(compdata$FundId))))
