size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE,),
ymin = 0, ymax = 3)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE,))
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE,)
xmin = 3, xmax = 6, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE,)
xmin = 3, xmax = 6, ymin = 2, ymax = 8)
rm(bubexset)
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = 3, xmax = 6, ymin = 2, ymax = 8)
rm(bubexset)
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = 3, xmax = 6, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = 3, xmax = 6)#, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = -3, xmax = 6)#, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = -30000, xmax = 6)#, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = -Inf, xmax = Inf)#, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = -100, xmax = Inf)#, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = -10000, xmax = Inf)#, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = -10000000, xmax = Inf)#, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = -1, xmax = Inf)#, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = -Inf, xmax = Inf)#, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
# example of NCCF vs. Performance bubble chart
bubexset <- panelB[panelB$FundId == 314 &
panelB$RefDate == as.Date('2013-10-31'), ]
#png("testQuality.png", width = 640, height = 640)
ggplot(bubexset, aes(Perf3y3mRatio,
RatioToBS3m,
size = StDev3y3mRatio,
label=ItemId)) +
geom_point(aes(colour = ItemType)) +
geom_text(size=3) +
xlab("Performance 3y (Ratio to BS)") + ylab("NCCF 3m (Ratio to BS)") +
labs(title = bubexset[bubexset$ItemId == 'OMGI', "FundName"]) +
theme(plot.title = element_text(face = "bold")) +
scale_colour_manual(values = c("cyan", "green")) +
scale_size_continuous(range = c(6, 20),
name = "Standard Dev. 3y\n(Ratio to BS)") +
annotation_custom(
grob = tableGrob(bubexset[! bubexset$ItemType =="OMGI",
c("ItemId", "FundName")],
show.rownames = FALSE,
show.box      = FALSE,
gpar.coretext = gpar(fontsize = 7),
show.colnames = FALSE),
xmin = -Inf)#, xmax = Inf)#, ymin = 2, ymax = 8)
rm(bubexset)
#dev.off()
?table
names(panelA)
names(panelB)
table(panelB$Sector)
ggplot(panelB, aes(x=Perf3y3mRatio, y=ratioToBS3m)) +
geom_point(shape=1) +
geom_smooth(method= "lm", se = TRUE) +
facet_wrap( ~ Sector) +
theme(plot.title = element_text(lineheight=.8, face="bold", size = 10)) +
ggtitle("3m NCCF ratio to best seller by Relative performance (3y) \n") +
#theme(legend.title=element_blank()) +
ylab("3m NCCF ratio") +
xlab("3y Performance ratio")
library(ggplot2)
library(scales)
#library(zoo)
library(car)
ggplot(panelB, aes(x=Perf3y3mRatio, y=ratioToBS3m)) +
geom_point(shape=1) +
geom_smooth(method= "lm", se = TRUE) +
facet_wrap( ~ Sector) +
theme(plot.title = element_text(lineheight=.8, face="bold", size = 10)) +
ggtitle("3m NCCF ratio to best seller by Relative performance (3y) \n") +
#theme(legend.title=element_blank()) +
ylab("3m NCCF ratio") +
xlab("3y Performance ratio")
ggplot(panelB, aes(x=Perf3y3mRatio, y=RatioToBS3m)) +
geom_point(shape=1) +
geom_smooth(method= "lm", se = TRUE) +
facet_wrap( ~ Sector) +
theme(plot.title = element_text(lineheight=.8, face="bold", size = 10)) +
ggtitle("3m NCCF ratio to best seller by Relative performance (3y) \n") +
#theme(legend.title=element_blank()) +
ylab("3m NCCF ratio") +
xlab("3y Performance ratio")
library(ggplot2)
library(scales)
library(car)
library(RODBC)
channel <- odbcConnect("SQLServerPerfRep")
rawdata <- sqlQuery(channel, "SELECT * FROM vw_EstimatedNCCF ORDER BY FundCode, RefDate")
close(channel)
rm(channel)
save(rawdata, file = "OMGIset.Rda")
load("OMGIset.Rda")
summary(rawdata)
colnames(rawdata)[names(rawdata) == "NCCFEstimate"] <- "NCCF"
rawdata$RefDate <- as.Date(rawdata$RefDate)
print(paste0("Raw number of products: ",
as.character(length(unique(rawdata$FundCode)))))
print(paste0("Observations: ",
as.character(length(rawdata$FundCode))))
#remove outliers
NCCFtolerance <- 0.5
print(paste0("Outliers with |NCCF| > ",
as.character(NCCFtolerance*100), "%: " ,
sum(rawdata$NCCF > NCCFtolerance |
rawdata$NCCF < -NCCFtolerance, na.rm = TRUE)))
panelA <- rawdata[rawdata$NCCF < NCCFtolerance &
rawdata$NCCF > -NCCFtolerance, ]
ExcludeFunds <- c("SKPROP")
print(paste0("Excluded funds: ", ExcludeFunds))
sum(panelA$FundCode %in% ExcludeFunds, na.rm=TRUE)
panelA <- panelA[! panelA$FundCode %in% ExcludeFunds, ]
#exclude Select seeded
#summary(panelA$IsSelect)
print(paste0("Seeded Select funds obs.: ", as.character(
sum(panelA$IsSelect == 1, na.rm=TRUE))))
panelA <- panelA[! panelA$IsSelect == 1, ]
print(paste0("Final number of products: ",
as.character(length(unique(panelA$FundCode)))))
print(paste0("Final number of observations: ",
as.character(length(panelA$FundCode))))
#summary(panelA)
#######ADDED SETS
#extreme performers
extremeThresh <- 0.15
panelA_extr <- panelA[panelA$Rank1y < extremeThresh |
panelA$Rank1y > 1- extremeThresh, ]
#normal performers
panelA_mid <- panelA[panelA$Rank1y > extremeThresh &
panelA$Rank1y < 1- extremeThresh, ]
#scaled sets
# dataScaled <- data.frame(scale(panelA[, c("NCCF",
#                                              "RelPerf1y",
#                                              "RelPerf2y",
#                                              "RelPerf3y",
#                                              "RelPerf3m",
#                                              "RelPerf6m",
#                                              "Rank1y",
#                                              "Rank3y")]))
#
ggplot(na.omit(panelA[panelA$Vehicle == "OEIC" | panelA$Vehicle == "UCITS4", ]
[,c("NCCF", "RelPerf3y", "Vehicle", "AssetClass")]),
aes(x=RelPerf3y, y=NCCF)) +
geom_point(shape=1) +
geom_smooth(method= "lm", se = TRUE) +
facet_wrap( ~ AssetClass, nrow=2) +
theme(plot.title = element_text(lineheight=.8, face="bold", size = 10)) +
ggtitle("Monthly NCCF* by Relative performance (3y) \n") +
#theme(legend.title=element_blank()) +
scale_x_continuous(labels=percent) +
scale_y_continuous(labels=percent) +
ylab("NCCF") +
xlab("3y Relative Performance")
